<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/luxon@1.26.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.1/dist/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.0.0"></script>
  <script src="https://www.chartjs.org/chartjs-chart-financial/chartjs-chart-financial.js"></script>
  <title>Vite App</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
    }

    canvas {
      display: block;
    }

    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
  </style>
</head>

<body>
  <div id="container">
    <h1>Real Time BTC/USD Price</h1>
    <h2>Price History</h2>
    <canvas id="myChart"></canvas>
  </div>
  </div>
  <script>
    const canvas = document.getElementById('myChart');
    const zoomFactor = 10;
    // FEAR
    // GREED
    let testData = [
      {
        x: 1, h: 2, y: 10
      }, {
        x: 2, h: 3, y: 20
      },
      {
        x: 3, h: 4, y: 30
      }, {
        x: 4, h: 5, y: 40
      },
      {
        x: 5, h: 6, y: 50
      },
      {
        x: 6, h: 2, y: 60
      },
      {
        x: 7, h: 3, y: 70
      },
      {
        x: 8, h: 10, y: 80
      },
      {
        x: 9, h: 5, y: 10
      },
      {
        x: 10, h: 6, y: 20
      },
      {
        x: 11, h: 1, y: 30
      }
    ]


    optimizeCanvas();
    renderGrid();
    renderChart(testData);

    function optimizeCanvas() {
      const { width, height } = canvas.getBoundingClientRect();
      const scaleFactor = 4;
      canvas.width = width * window.devicePixelRatio * scaleFactor;
      canvas.height = height * window.devicePixelRatio * scaleFactor;
      canvas.style.width = `${width * scaleFactor}px`;
      canvas.style.height = `${height * scaleFactor}px`;
    }

    function renderGrid() {
      for (let i = 0; i < canvas.width; i += 10) {
        for (let j = 0; j < canvas.height; j += 10) {
          const ctx = canvas.getContext('2d');
          ctx.beginPath();
          ctx.rect(i, j, 10, 10);
          ctx.strokeStyle = '#333';
          ctx.stroke();
        }
      }
    }
    function drawCharacter(x, y, h) {
      // highlight every rectangle in grid
      const ctx = canvas.getContext('2d');
      ctx.beginPath();
      for (let i = x * 60; i < x * 60 + 40; i += 10) {
        for (let j = (-y + 1000); j > (-y + 1000) - h * 0.5 * 5; j -= 10) {
          ctx.rect(i, j, 10, 10);
          ctx.fillStyle = 'red';
          ctx.fill();
        }
      }
      ctx.closePath();
    }

    function slopeNature(arr) {
      // get slope of array
      return arr[arr.length - 1].y - arr[0].y;      
    }

    function renderChart(testData) {
      // plot points on grid
      const scaleFactor = 5;
      const ctx = canvas.getContext('2d');
      let text = '';
      let charPos = 0;
      
      let cycle = 0;
      for (let i = 0; i < testData.length; i++) {
        let { x, h, y } = testData[i];
        if(!text) {
          // get next 6 letters
          let nature = slopeNature(testData.slice(i, i + 6));
          if (nature >= 0) {
            text = 'GREED';
          } else {
            text = 'FEAR';
          }
        }
        y = parseInt(y);
        // draw rectangle
        ctx.beginPath();
        ctx.rect(x * 60, (-y + 1000), 50, - h * zoomFactor * scaleFactor);
        ctx.strokeStyle = 'red';
        ctx.stroke();
        ctx.fillStyle = 'transparent';
        ctx.fill();
        ctx.closePath();
        // draw text in rectangle
        drawLetterA(text[charPos%text.length], x * 60, (-y + 1000 + (- h * zoomFactor * scaleFactor)), h * zoomFactor * scaleFactor);
        // if rendering last character, reset cycle
        charPos++;
        if( (text[i] == 'R' || text[i] == 'D') && charPos == text.length) {
          text = '';
          charPos = 0;
        }
      }
    }
    function drawLetterA(letter, x, y, h) {
      const canvas = document.getElementById('myChart');
      const ctx = canvas.getContext('2d');

      const letterGrids = {
        A: [
          [0, 1, 1, 1, 0],
          [1, 0, 0, 0, 1],
          [1, 1, 1, 1, 1],
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1]
        ],
        B: [
          [1, 1, 1, 1, 0],
          [1, 0, 0, 0, 1],
          [1, 1, 1, 1, 0],
          [1, 0, 0, 0, 1],
          [1, 1, 1, 1, 0]
        ],
        C: [
          [0, 1, 1, 1, 1],
          [1, 0, 0, 0, 0],
          [1, 0, 0, 0, 0],
          [1, 0, 0, 0, 0],
          [0, 1, 1, 1, 1]
        ],
        D: [
          [1, 1, 1, 1, 0],
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [1, 1, 1, 1, 0]
        ],
        E: [
          [1, 1, 1, 1, 1],
          [1, 0, 0, 0, 0],
          [1, 1, 1, 1, 0],
          [1, 0, 0, 0, 0],
          [1, 1, 1, 1, 1]
        ],
        F: [
          [1, 1, 1, 1, 1],
          [1, 0, 0, 0, 0],
          [1, 1, 1, 1, 0],
          [1, 0, 0, 0, 0],
          [1, 0, 0, 0, 0]
        ],
        G: [
          [0, 1, 1, 1, 1],
          [1, 0, 0, 0, 0],
          [1, 0, 1, 1, 1],
          [1, 0, 0, 0, 1],
          [0, 1, 1, 1, 1]
        ],
        H: [
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [1, 1, 1, 1, 1],
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1]
        ],
        I: [
          [1, 1, 1, 1, 1],
          [0, 1, 0, 0, 0],
          [0, 1, 0, 0, 0],
          [0, 1, 0, 0, 0],
          [1, 1, 1, 1, 1]
        ],
        J: [
          [0, 0, 1, 1, 1],
          [0, 0, 0, 1, 0],
          [0, 0, 0, 1, 0],
          [1, 0, 0, 1, 0],
          [0, 1, 1, 0, 0]
        ],
        K: [
          [1, 0, 0, 0, 1],
          [1, 0, 0, 1, 0],
          [1, 1, 1, 0, 0],
          [1, 0, 0, 1, 0],
          [1, 0, 0, 0, 1]
        ],
        L: [
          [1, 0, 0, 0, 0],
          [1, 0, 0, 0, 0],
          [1, 0, 0, 0, 0],
          [1, 0, 0, 0, 0],
          [1, 1, 1, 1, 1]
        ],
        M: [
          [1, 0, 0, 0, 1],
          [1, 1, 0, 1, 1],
          [1, 0, 1, 0, 1],
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1]
        ],
        N: [
          [1, 0, 0, 0, 1],
          [1, 1, 0, 0, 1],
          [1, 0, 1, 0, 1],
          [1, 0, 0, 1, 1],
          [1, 0, 0, 0, 1]
        ],
        O: [
          [0, 1, 1, 1, 0],
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [0, 1, 1, 1, 0]
        ],
        P: [
          [1, 1, 1, 1, 0],
          [1, 0, 0, 0, 1],
          [1, 1, 1, 1, 0],
          [1, 0, 0, 0, 0],
          [1, 0, 0, 0, 0]
        ],
        Q: [
          [0, 1, 1, 1, 0],
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [1, 0, 1, 1, 0],
          [0, 1, 1, 1, 1]
        ],
        R: [
          [1, 1, 1, 1, 0],
          [1, 0, 0, 0, 1],
          [1, 1, 1, 1, 0],
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1]
        ],
        S: [
          [0, 1, 1, 1, 1],
          [1, 0, 0, 0, 0],
          [0, 1, 1, 1, 0],
          [0, 0, 0, 0, 1],
          [1, 1, 1, 1, 0]
        ],
        T: [
          [1, 1, 1, 1, 1],
          [0, 1, 0, 0, 0],
          [0, 1, 0, 0, 0],
          [0, 1, 0, 0, 0],
          [0, 1, 0, 0, 0]
        ],
        U: [
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [0, 1, 1, 1, 0]
        ],
        V: [
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [0, 1, 0, 1, 0],
          [0, 0, 1, 0, 0]
        ],
        W: [
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [1, 0, 1, 0, 1],
          [1, 1, 0, 1, 1],
          [1, 0, 0, 0, 1]
        ],
        X: [
          [1, 0, 0, 0, 1],
          [0, 1, 0, 1, 0],
          [0, 0, 1, 0, 0],
          [0, 1, 0, 1, 0],
          [1, 0, 0, 0, 1]
        ],
        Y: [
          [1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1],
          [0, 1, 0, 1, 0],
          [0, 0, 1, 0, 0],
          [0, 0, 1, 0, 0]
        ],
        Z: [
          [1, 1, 1, 1, 1],
          [0, 0, 0, 1, 0],
          [0, 0, 1, 0, 0],
          [0, 1, 0, 0, 0],
          [1, 1, 1, 1, 1]
        ]
      };

      const grid = letterGrids[letter];
      const gridSize = 10;
      const letterWidth = grid[0].length * gridSize;
      let letterHeight = grid.length * gridSize;
      const startX = x
      const startY = y - (letterHeight / 60);
      if (h > letterHeight) {
        for (let i = letterHeight / zoomFactor; i < parseInt(h) / zoomFactor; i++) {
          if (letter == 'E' || letter == 'R' || letter == 'G' || letter == 'D' || letter == 'A') {
            // add row before mid row before mid row
            if (h > letterHeight) {
              grid.splice(Math.floor(grid.length / 2), 0, grid[1]);
              letterHeight = grid.length * gridSize;
            }
            // add before last row
            if (h > letterHeight) {
              grid.splice(grid.length - 1, 0, grid[grid.length - 2]);
              letterHeight = grid.length * gridSize;
            }
          }
          else {
            grid.push(grid[grid.length - 1]);
          }
        }
      }

      for (let i = 0; i < grid.length; i++) {
        for (let j = 0; j < grid[i].length; j++) {
          if (grid[i][j] === 1) {
            const rectX = startX + j * gridSize;
            const rectY = startY + i * gridSize;
            ctx.fillStyle = 'white';
            ctx.fillRect(rectX, rectY, gridSize, gridSize);
          }
        }
      }
    }



  </script>
</body>

</html>